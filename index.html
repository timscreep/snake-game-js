<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Змейка — Панель управления</title>

<style>
  :root {
    --base: #1e1e2e;
    --surface: #313244;
    --lavender: #cba6f7;
    --text: #cdd6f4;
  }

  body {
    background: var(--base);
    color: var(--text);
    font-family: Arial, sans-serif;
    text-align: center;
    padding: 20px;
    touch-action: none;
    user-select: none;
  }

  canvas {
    background: var(--surface);
    border: 3px solid var(--lavender);
    border-radius: 12px;
    width: 95vw;
    height: 95vw;
    max-width: 380px;
    max-height: 380px;
    display: block;
    margin: 0 auto;
  }

  h1 { color: var(--lavender); font-size: 32px; margin-bottom: 10px; }
  #score { font-size: 24px; margin-bottom: 15px; }

  /* Панель управления */
  #control-panel {
    margin-top: 15px;
    width: 95vw;
    max-width: 380px;
    height: 60px;
    background: #45475a;
    border-radius: 12px;
    touch-action: none;
    display: block;
    margin-left: auto;
    margin-right: auto;
  }

</style>
</head>

<body>

<h1>Змейка</h1>
<div id="score">Очки: 0</div>
<canvas id="game" width="380" height="380"></canvas>

<div id="control-panel"></div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const scoreEl = document.getElementById("score");
const panel = document.getElementById("control-panel");

const cell = 20;
const cells = canvas.width / cell;

let snake = [{ x: 5, y: 5 }];
let vx = 1, vy = 0;
let food = randomFood();
let score = 0;

// Звуки
const sndTurn = new Audio("turn.mp3");
const sndEat = new Audio("eat.mp3");
const sndDie = new Audio("die.mp3");
[sndTurn, sndEat, sndDie].forEach(s => { s.preload = "auto"; s.volume = 0.4; });

// Вибрация
function vib(ms){ if(navigator.vibrate) navigator.vibrate(ms); }

function randomFood() {
  return { x: Math.floor(Math.random() * cells), y: Math.floor(Math.random() * cells) };
}

function reset() {
  vib(100);
  sndDie.play();
  snake = [{ x:5, y:5 }];
  vx=1; vy=0;
  score=0;
  scoreEl.textContent = "Очки: "+score;
  food=randomFood();
}

function update() {
  const head={x:snake[0].x+vx, y:snake[0].y+vy};
  if(head.x<0||head.y<0||head.x>=cells||head.y>=cells){ reset(); return; }
  for(let p of snake){ if(p.x===head.x && p.y===head.y){ reset(); return; } }
  snake.unshift(head);

  if(head.x===food.x && head.y===food.y){
    score++;
    scoreEl.textContent="Очки: "+score;
    vib(50); sndEat.play();
    food=randomFood();
  }else snake.pop();
}

function draw(){
  ctx.fillStyle="#313244"; ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.fillStyle="#f38ba8"; ctx.fillRect(food.x*cell,food.y*cell,cell,cell);
  ctx.fillStyle="#a6e3a1"; snake.forEach(p=>ctx.fillRect(p.x*cell,p.y*cell,cell-1,cell-1));
}

function loop(){ update(); draw(); setTimeout(loop,120); }
loop();

// ==== Управление через панель ====
let startX=0, startY=0;
panel.addEventListener("touchstart", e=>{ startX=e.touches[0].clientX; startY=e.touches[0].clientY; }, {passive:true});
panel.addEventListener("touchmove", e=>{
  const dx=e.touches[0].clientX-startX;
  const dy=e.touches[0].clientY-startY;
  const threshold=15;
  if(Math.abs(dx)>Math.abs(dy)){
    if(dx>threshold && vx!==-1){ vx=1; vy=0; vib(10); sndTurn.play(); startX=e.touches[0].clientX; startY=e.touches[0].clientY; }
    if(dx<-threshold && vx!==1){ vx=-1; vy=0; vib(10); sndTurn.play(); startX=e.touches[0].clientX; startY=e.touches[0].clientY; }
  }else{
    if(dy>threshold && vy!==-1){ vx=0; vy=1; vib(10); sndTurn.play(); startX=e.touches[0].clientX; startY=e.touches[0].clientY; }
    if(dy<-threshold && vy!==1){ vx=0; vy=-1; vib(10); sndTurn.play(); startX=e.touches[0].clientX; startY=e.touches[0].clientY; }
  }
}, {passive:true});
</script>

</body>
</html>
